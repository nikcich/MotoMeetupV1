<!DOCTYPE html>
<html>
  <head>
    <title>Meetup Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src = "https://smtpjs.com/v3/smtp.js"></script>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkQaHkO5f2LymmHzYD0bAcAxj6h9a2kMU&callback=initMap&libraries=places&v=weekly" defer ></script>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@2.3.2/dist/email.min.js"></script>
      <script type="text/javascript">
        (function(){
            emailjs.init("user_mtIxxJUUhp65VCg4m27S0");
        })();
      </script>

    <script>
      "use strict";

      let map;
      //let person = {name: "", lat: , long: , bike: ""};
      let nikolas = {name: "Nikolas#9362", lat: 33.1031744, long:-96.67055030000002, bike: "2017 Z650"};
      let yammie = {name: "yammienoob#7923", lat: 30.267153,long: -97.7430608, bike: "2007 HAYABUSA"};
      let spite = {name: "Spite#2151", lat: 30.267153,long: -97.7430608, bike: "KTM SMCR"};
      let CloutRangerRusty = {name: "CloutRangerRusty#6689", lat:41.6000317 , long: -87.9381112, bike: "1984 Nighthawk"};
      let dillemma = {name: "dillemma_1234#9244", lat: -34.72,long: 138.673, bike: "GPX250"};
      let chococow = {name: "ChocoCow#2619", lat: 35.8240265,long: -80.2533838, bike: "2004 Buell XB12S Lightning"};
      let caveman = {name: "Caveman#5668", lat: 33.8532,long: -96.5025, bike: "2016 VROD Muscle"};

      let PeopleList = [nikolas, yammie, spite, CloutRangerRusty, dillemma, chococow, caveman];

      let markers = [];
      let windows = [];

      let checked = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: {
            lat: 36.670205,
            lng: -97.295511
          },
          zoom: 4,
          styles: 
          [
            {
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#1d2c4d"
                }
              ]
            },
            {
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#8ec3b9"
                }
              ]
            },
            {
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#1a3646"
                }
              ]
            },
            {
              "featureType": "administrative.country",
              "elementType": "geometry.stroke",
              "stylers": [
                {
                  "color": "#4b6878"
                }
              ]
            },
            {
              "featureType": "administrative.land_parcel",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#64779e"
                }
              ]
            },
            {
              "featureType": "administrative.province",
              "elementType": "geometry.stroke",
              "stylers": [
                {
                  "color": "#4b6878"
                }
              ]
            },
            {
              "featureType": "landscape.man_made",
              "elementType": "geometry.stroke",
              "stylers": [
                {
                  "color": "#334e87"
                }
              ]
            },
            {
              "featureType": "landscape.natural",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#023e58"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#283d6a"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#6f9ba5"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#1d2c4d"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "geometry.fill",
              "stylers": [
                {
                  "color": "#023e58"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#3C7680"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#304a7d"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#98a5be"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#1d2c4d"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#2c6675"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "geometry.stroke",
              "stylers": [
                {
                  "color": "#255763"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#b0d5ce"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#023e58"
                }
              ]
            },
            {
              "featureType": "transit",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#98a5be"
                }
              ]
            },
            {
              "featureType": "transit",
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#1d2c4d"
                }
              ]
            },
            {
              "featureType": "transit.line",
              "elementType": "geometry.fill",
              "stylers": [
                {
                  "color": "#283d6a"
                }
              ]
            },
            {
              "featureType": "transit.station",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#3a4762"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#0e1626"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#4e6d70"
                }
              ]
            }
          ]
        });

        for(let i =0; i < PeopleList.length; i++){
          if(checked.length > 0){
            let mybool = false;
            for(let j = 0; j < checked.length; j++){
              if(PeopleList[i].lat === checked[j].lat && PeopleList[i].long === checked[j].long){
                mybool = true;
                checked[j].name = checked[j].name + ", " + PeopleList[i].name  + " ("+ PeopleList[i].bike + ")";
                break;
              }
            }
            if(!mybool){
              checked.push({name: PeopleList[i].name  + " ("+ PeopleList[i].bike + ")", lat: PeopleList[i].lat, long: PeopleList[i].long});
            }
          }else{
            checked.push({name: PeopleList[i].name + " ("+ PeopleList[i].bike + ")", lat: PeopleList[i].lat, long: PeopleList[i].long});
          }
        }

        for(let i =0; i < checked.length; i++){
          var myLatlng = new google.maps.LatLng(checked[i].lat, checked[i].long);
          var marker = new google.maps.Marker({
            position: myLatlng,
            title: checked[i].name
            })

          var infoWindow = new google.maps.InfoWindow({
            content:'<h3>'+ checked[i].name+'</h3>'
          })

          windows.push(infoWindow);

          markers.push(marker);
        }

        

        for(let i = 0; i < markers.length; i++){
          markers[i].setMap(map);
          markers[i].addListener('click', function(){
            windows[i].open(map, markers[i]);
          });
        }
        
      }
    </script>
      
    <script>
      
/////////////////////////////////////////////////////////////////////////////////
      var searchInput1 = 'search_input';

      $(document).ready(function () {
          var autocomplete;
          autocomplete = new google.maps.places.Autocomplete((document.getElementById(searchInput1)), {
              types: ['geocode'],
          });
        
          google.maps.event.addListener(autocomplete, 'place_changed', function () {
              var near_place = autocomplete.getPlace();

              document.getElementById('loc_lat').value = near_place.geometry.location.lat();
              document.getElementById('loc_long').value = near_place.geometry.location.lng();

              document.getElementById('latitude_view').innerHTML = near_place.geometry.location.lat();
              document.getElementById('longitude_view').innerHTML = near_place.geometry.location.lng();
              
          });
      });

      $(document).on('change', '#'+searchInput1, function () {
        document.getElementById('latitude_view').innerHTML = '0';
        document.getElementById('longitude_view').innerHTML = '0';
      });


    </script>

<header>
  <nav>
    <ul>
      <h3 id = "headh">Motorcycle Meetups Member List</h3>
    </ul>
  </nav>
</header>

  </head>

  

  <body>
    <div id="map"></div>

    <div id="root"></div>


    <!-- Autocomplete location search input --> 
    <div class="form-group">
      <label>Location:</label>
      <input type="text" class="form-control" id="search_input" placeholder="Type general location..." />
      <input type="hidden" id="loc_lat" />
      <input type="hidden" id="loc_long" />
    </div>

    <!-- Display latitude and longitude -->
    <div class="latlong-view">
      <p><b>Latitude:</b> <span id="latitude_view"></span></p>
      <p><b>Longitude:</b> <span id="longitude_view"></span></p>
    </div>


    <div id = "submitPart">
      <input type="text" class="DiscordName" id = "DiscordName" placeholder="Type Discord name with ID (Name#ID)" />
      <input type="text" class="biketype" id = "biketype" placeholder="Enter your bike (2017 GSX1300R HAYABUSA)" />
      <input type="button" class="AddToList" value="Click to Add To List" onclick="sendEmail()"/>
      <h1 class = "MayTake">Can take up to a day to process request</h1>
    </div>

    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <script type="text/javascript">
      function sendEmail() {
        
        var inputVal = document.getElementById("DiscordName").value;

        var bikeVal = document.getElementById("biketype").value;

        var latVal = document.getElementById("latitude_view").innerHTML;

        var LongVal = document.getElementById("longitude_view").innerHTML;
        
        if((latVal === '0' && LongVal === '0') || (latVal === '' && LongVal === '')){
          alert("Please enter a location first");
        }else if(inputVal === ''){
          alert("Please enter a username first");
        }else{
          var data = {
            service_id: 'gmail',
            template_id: 'bigdicks',
            user_id: 'user_mtIxxJUUhp65VCg4m27S0',
            template_params: {
              'username': inputVal,
              'bike': bikeVal,
              'latv': latVal,
              'longv': LongVal
            }
          };
        
          $.ajax('https://api.emailjs.com/api/v1.0/email/send', {
              type: 'POST',
              data: JSON.stringify(data),
              contentType: 'application/json'
          }).done(function() {
              alert('Your request will be verified before adding');
          }).fail(function(error) {
              alert('Oops... ' + JSON.stringify(error));
          });
        }
      }
    </script>
    
    <div id = "FindPeople">
      <p><b>--FIND MEMBERS NEAR ME--</b> <span id="myLabel1"></span></p>
      <input type="text" class="Radius" id = "Radius" placeholder="Enter radius in miles" />
      <input type="button" class="FindPpl" value="Click to Find People" onclick="findPeople()"/>
      <p><b id = "resultLabel">Members will appear here:</b> <span id="myLabel2"></span></p>
      <p><b id = "results">No members to display</b> <span id="myLabel2"></span></p>
    </div>





    <div id = "advert">
      <h3>---Upcoming Member Rides---</h3>

      <h2>Location: N/A</h2>
      <h2>Date: N/A</h2>
      <h2 id = "bottomh2">Host: N/A</h2>

      <h2>Request to Host a Meet</h2>
      <input type="text" class="form-control2" id="search_input2" placeholder="Type meetup address..." />

      <div class="latlong-view2">
        <p><b>Location:</b> <span id="addy_view2"></span></p>
      </div>
      <input type="text" class="Radius" id = "HostName" placeholder="Enter hosts Discord name with ID (Name#ID)" />
      <input type="text" class="date" id = "DateBox" placeholder="Enter the date and time (12:00pm MM/DD/YY)" />
      <input type="button" class="FindPpl" value="Click to request meetup ad" onclick="requestMeet()"/>


    </div>

    <script>
      function requestMeet(){

        var addy = document.getElementById('addy_view2').innerHTML;
        var datetime = document.getElementById('DateBox').value;
        var hoster = document.getElementById('HostName').value;
        
        
        
        if(addy === '' || datetime === '' || hoster === ''){
          alert("Please enter all the data first");
        }else{
          var data = {
            service_id: 'gmail',
            template_id: 'template_P549kwWX',
            user_id: 'user_mtIxxJUUhp65VCg4m27S0',
            template_params: {
              'hoster': hoster,
              'date': datetime,
              'addy': addy
            }
          };
        
          $.ajax('https://api.emailjs.com/api/v1.0/email/send', {
              type: 'POST',
              data: JSON.stringify(data),
              contentType: 'application/json'
          }).done(function() {
              alert('Your request will be verified before adding');
          }).fail(function(error) {
              alert('Oops... ' + JSON.stringify(error));
          });
        }




      }
    </script>

    <script>
      var searchInput = 'search_input2';

      $(document).ready(function () {
          var autocomplete;
          autocomplete = new google.maps.places.Autocomplete((document.getElementById(searchInput)), {
              types: ['geocode'],
          });
        
          google.maps.event.addListener(autocomplete, 'place_changed', function () {
              var near_place = autocomplete.getPlace();
              var addy2 = "";
              for(let i =0; i < near_place.address_components.length; i++){
                addy2 = addy2 + " " + near_place.address_components[i].long_name;
              }
              document.getElementById('addy_view2').innerHTML = addy2;
              //near_place.geometry.location.lng();
          });
      });

      $(document).on('change', '#'+searchInput, function () {
          document.getElementById('addy_view2').innerHTML = 'N/A';
      });

    </script>




    <div id = "everyone">
      <h1>Member Meetup Resource Created and Operated by Nik</h1>
      
    </div>

    <script type="text/javascript">

      function toRadians(n){
        var pi = Math.PI;
        return n * (pi/180);
      }

      function getDist(lat1, lat2, lon1, lon2){
        var lon1 = toRadians(lon1); 
        var lon2 = toRadians(lon2); 
        var lat1 = toRadians(lat1); 
        var lat2 = toRadians(lat2); 

        var dlon = lon2 - lon1;  
        var dlat = lat2 - lat1; 
        var a = Math.pow(Math.sin(dlat / 2), 2) 
                 + Math.cos(lat1) * Math.cos(lat2) 
                 * Math.pow(Math.sin(dlon / 2),2); 
              
        var c = 2 * Math.asin(Math.sqrt(a)); 

        var r = 3956;

        return(c*r);
      }

      function findPeople(){
        
        var radius = document.getElementById("Radius").value;
        var latVal = document.getElementById("latitude_view").innerHTML;
        var LongVal = document.getElementById("longitude_view").innerHTML;
        var resultLabel = document.getElementById("results");
        
        var found = "";

        if((latVal === '0' && LongVal === '0') || (latVal === '' && LongVal === '')){
          alert("Please select a location first");
        }else{

          for(let i = 0; i < PeopleList.length; i ++){
            var dist = getDist(PeopleList[i].lat, latVal, PeopleList[i].long, LongVal);
            if(dist <= radius){
              if(found === ""){
                found = "@"+PeopleList[i].name;
              }else{
                found = found + "  @" + PeopleList[i].name;
              }
              
            }
          }
          
          if(found === ""){
            found = "No members near you :(";
          }

          resultLabel.innerText = found;
        }
      }

    </script>


  </body>
</html>